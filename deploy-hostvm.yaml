
resources:
  - name: tesla-k80
    type: compute.v1.instance

    properties:
      zone: europe-west1-b
      minCpuPlatform: Automatic
      machineType: projects/vex-bed/zones/europe-west1-b/machineTypes/n1-standard-1
      metadata:
        items:
        - key: gce-container-declaration
          value: |
            spec:
            containers:
            - name: tesla-k80
              image: us.gcr.io/vex-bed/remviz
              securityContext:
                privileged: true
              stdin: false
              tty: false
              restartPolicy: Always

        - key: startup-script
          value: |
            #!/usr/bin/env bash
            apt-add-repository -y ppa:graphics-drivers/ppa
            apt-get update && apt-get install -y nvidia-387
            nvidia-xconfig -a --use-display-device=None --virtual=4096x2160

      guestAccelerators:
      - acceleratorType: projects/vex-bed/zones/europe-west1-b/acceleratorTypes/nvidia-tesla-k80
        acceleratorCount: 1
    
      disks:
      - deviceName: "tesla-k80"
        type: PERSISTENT
        boot: true
        mode: READ_WRITE
        autoDelete: true
        initializeParams:
          sourceImage: "projects/ubuntu-os-cloud/global/images/ubuntu-1604-xenial-v20171121a"
          diskType: "projects/vex-bed/zones/europe-west1-b/diskTypes/pd-standard"
          diskSizeGb: "200"
          canIpForward: false
      
      networkInterfaces:
      - network: "projects/vex-bed/global/networks/default"
        subnetwork: "projects/vex-bed/regions/europe-west1/subnetworks/default"
        accessConfigs:
          - name: "External NAT"
            type: "ONE_TO_ONE_NAT"

      scheduling:
        preemptible: false
        onHostMaintenance: TERMINATE
        automaticRestart: true
        deletionProtection: false
